---
- name: add key for elastic.co repositories
  apt_key:
    url: "https://artifacts.elastic.co/GPG-KEY-elasticsearch"    
    state: present

- name: add elastic.co repositories
  apt_repository:
    repo: 'deb https://artifacts.elastic.co/packages/6.x/apt stable main'
    state: present

- name: Install filebeat package
  apt:
    name: {{ item }}
    update_cache: yes
  with_items:
    - filebeat    

- name: Copy filebeat key
  copy: src=filebeat dest=/etc/ssl/

- name: Copy filebeat configuration
  template: src=filebeat.yml.j2 dest=/etc/filebeat/filebeat.yml
  notify: restart filebeat 

- name: start filebeat
  systemd:
    state: restarted
    enabled: yes
    name: filebeat