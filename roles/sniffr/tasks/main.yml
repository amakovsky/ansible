---
- name: Include vault vars files
  include_vars:
    file: ../../files/vault_var.yml

- name: Install libhiredis-dev
  apt:
    name: libhiredis-dev
    update_cache: true

- name: create snifr config
  file:
    path: "{{ sniffr_dir }}/log"
    state: directory
    owner: "{{ sniffr_user }}"
    group: "{{ sniffr_group }}"
    mode: 0775

- name: Download and unarchive sniff
  unarchive:
    src: "{{ sniffr_source }}&private_token={{ gitlab_private_token }}"
    dest: "{{ sniffr_dir }}"
    remote_src: true
    owner: "{{ sniffr_user }}"
    group: "{{ sniffr_group }}"
    mode: 0775

- name: copy sniffr start script
  template:
    src: 'sniffr.sh.j2'
    dest: "{{ sniffr_dir }}/sniffr.sh"
    owner: "{{ sniffr_user }}"
    group: "{{ sniffr_group }}"
    mode: '0770'
