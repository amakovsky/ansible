web:
  image: 'gitlab/gitlab-ee:latest'
  restart: always
  hostname: '{{ gitlab_name }}'
  environment:
    GITLAB_OMNIBUS_CONFIG: |
     external_url 'https://{{ gitlab_name }}'
     letsencrypt['enable'] = false
     nginx['redirect_http_to_https'] = true
     nginx['ssl_certificate'] = "/var/ssl/gitlab.gettwifi.com.crt"
     nginx['ssl_certificate_key'] = "/var/ssl/gitlab.gettwifi.com.key"
     gitlab_rails['gitlab_signup_enabled'] = false
     gitlab_rails['time_zone'] = 'Europe/Moscow'
     gitlab_rails['backup_upload_connection'] = {
        'provider' => 'AWS',
        'region' => 'ams3',
        'aws_access_key_id' => 'VGKQEXC2RQ3A24XZLDXU',
        'aws_secret_access_key' => 'srDfud8kTGadwhx1oT7gUg+Io9bPM7+J2omHdllQPSQ',
        'endpoint'              => 'https://ams3.digitaloceanspaces.com'
     }
     gitlab_rails['backup_upload_remote_directory'] = 'gettwifi-b'
  ports:
    - '80:80'
    - '443:443'
    - '22:22'
  volumes:
    - '/etc/localtime:/etc/localtime'
    - '/srv/gitlab/config:/etc/gitlab'
    - '/srv/gitlab/logs:/var/log/gitlab'
    - '/srv/gitlab/data:/var/opt/gitlab'
    - '/srv/ssl:/var/ssl'