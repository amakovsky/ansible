---
cassandra_cluster_name: gettwifi_cluster
cassandra_recriate_cluster: false
cassandra_global_config_options:
  - option: cluster_name
    value: '{{ cassandra_cluster_name }}'
    regex: ''
    tab: ''
  - option: '- seeds'
    value: "{{ lookup('flattened', groups['cassandra']) }}"
    regex: '.*'
    tab: '          '
  - option: listen_address
    value: '{{ inventory_hostname }}'
    regex: ''
    tab: ''
  - option: rpc_address
    value: '{{ inventory_hostname }}'
    regex: ''
    tab: ''
  - option: endpoint_snitch
    value: 'GossipingPropertyFileSnitch'
    regex: ''
    tab: ''
  - option: auto_bootstrap
    value: 'false'
    regex: ''
    tab: ''

ufw_rules:
  - rule: 'allow'
    port: 22
    proto: 'tcp'
    from_ip:
      - "{{ hostvars[groups['openvpn'][0]].private_ip }}"
    to_ip: "{{ inventory_hostname }}"
  - rule: 'allow'
    port: 7000
    proto: 'tcp'
    from_ip: "{{ [groups['cassandra'], hostvars[groups['openvpn'][0]].private_ip]|flatten }}"
    to_ip: "{{ inventory_hostname }}"
  - rule: 'allow'
    port: 9042
    proto: 'tcp'
    from_ip: "{{ [groups['cassandra']]|flatten }}"
    to_ip: "{{ inventory_hostname }}"
  - rule: 'allow'
    port: 10050
    proto: 'tcp'
    from_ip: "{{ groups['zabbix'] }}"
    to_ip: "{{ inventory_hostname }}"